<!doctype html>
<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
        <script src="js/dataset.js"></script>
    </head>
    <body>
        <button id="selectallcrime">Select all</button>
        <form id="crimeSelect"></form>





        <script>
            $().ready(function() {




                $(document).on('crimeListReady', function() {
                    var crimeList = JSON.parse(sessionStorage.getItem('crimeList'));
                    console.log(crimeList);

                    var excludeCrime = JSON.parse(sessionStorage.getItem('excludeCrime'));

                    $('#crimeSelect').empty();
                    var count = 0;
                    $.each(crimeList, function(index, value) {
                        $('#crimeSelect').append(
                            '<input type="checkbox" id="crime'+count+'" class="crimeSelectBox" name="'+value+'" checked="true"/>'
                            +'<label for=crime'+count+'>'+value+'</label><br/>'
                        );

                        count += 1;
                    });

                    $.each(excludeCrime, function(index, value) {
                        var tag = 'input[class="crimeSelectBox"][name="'+value+'"]';
                        $(tag).prop("checked", false);
                    });

                    // Handle changes to checkbox.
                    $('.crimeSelectBox').change(function() {
                        var excludeCrime = JSON.parse(sessionStorage.getItem('excludeCrime'));

                        excludeCrime = [];
                        $('input[class="crimeSelectBox"]:not(:checked)').each(function() {
                            excludeCrime.push(this.name);
                        });

                        sessionStorage.setItem('excludeCrime', JSON.stringify(excludeCrime));
                        console.log(JSON.stringify(excludeCrime));
                    });

                    $('#selectallcrime').click(function() {


                        $('input[class="crimeSelectBox"]').each(function() {
                            // enable all. set to false, then click.
                            $(this).prop("checked", true);
                        });

                        // call change once only.
                        $('input[class="crimeSelectBox"]').each(function() {
                            $(this).change();
                            return false; // break out of loop.
                        });

                    });

                });
            });
        </script>
    </body>
</html>




